"use strict";(self.webpackChunkslack_clone=self.webpackChunkslack_clone||[]).push([[256],{5256:(e,t,a)=>{a.r(t),a.d(t,{default:()=>x});var n=a(2309),l=a(2545),s=a(9250),o=a(8678),r=a(2951),c=a(3274);const i=(0,c.Z)("div",{target:"e1q3fls52"})({name:"1a0r0eh",styles:"display:flex;flex-wrap:wrap;height:calc(100vh - 38px);flex-flow:column;position:relative"}),h=(0,c.Z)("header",{target:"e1q3fls51"})({name:"1ezwwi6",styles:"height:64px;display:flex;width:100%;--saf-0:rgba(var(--sk_foreground_low, 29, 28, 29), 0.13);box-shadow:0 1px 0 var(--saf-0);padding:20px 16px 20px 20px;font-weight:bold;align-items:center;& .header-right{display:flex;flex:1;justify-content:flex-end;align-items:center;}"}),p=(0,c.Z)("div",{target:"e1q3fls50"})({name:"czjct4",styles:"position:absolute;top:64px;left:0;width:100%;height:calc(100% - 64px);background:white;opacity:0.7;display:flex;align-items:center;justify-content:center;font-size:40px"});var f=a(3564),u=a(8667),d=a(9669),g=a.n(d),m=a(7294),w=a(6974),k=a(821),b=a(958);const x=()=>{const{workspace:e,channel:t}=(0,w.UO)(),{data:a}=(0,k.ZP)("/api/users",f.Z),[c,d,x]=(0,o.Z)(""),{data:v}=(0,k.ZP)(`/api/workspaces/${e}/channels/${t}`,f.Z),{data:C,mutate:Z,setSize:_}=(0,b.ZP)((a=>`/api/workspaces/${e}/channels/${t}/chats?perPage=20&page=${a+1}`),f.Z),{data:E}=(0,k.ZP)(a?`/api/workspaces/${e}/channels/${t}/members`:null,f.Z),[T]=(0,r.Z)(e),$=0===C?.[0]?.length||C&&C[C.length-1]?.length<20||!1,y=(0,m.useRef)(null),[S,D]=(0,m.useState)(!1),[z,B]=(0,m.useState)(!1),F=(0,m.useCallback)((n=>{if(n.preventDefault(),console.log(c),c?.trim()&&C&&v){const n=c;Z((e=>(e?.[0].unshift({id:(C[0][0]?.id||0)+1,content:n,UserId:a.id,User:a,ChannelId:v.id,Channel:v,createdAt:new Date}),e)),!1).then((()=>{x(""),y.current?.scrollToBottom()})),g().post(`/api/workspaces/${e}/channels/${t}/chats`,{content:c}).then((()=>{Z()})).catch(console.error)}}),[c,C,a,v,e,t]),P=(0,m.useCallback)((e=>{e.Channel.name!==t||!e.content.startsWith("uploads\\")&&e.UserId===a?.id||Z((t=>(t?.[0].unshift(e),t)),!1).then((()=>{y.current&&y.current.getScrollHeight()<y.current.getClientHeight()+y.current.getScrollTop()+150&&(console.log("scrollToBottom!",y.current?.getValues()),setTimeout((()=>{y.current?.scrollToBottom()}),50))}))}),[t,a]);(0,m.useEffect)((()=>(T?.on("message",P),()=>{T?.off("message",P)})),[T,P]),(0,m.useEffect)((()=>{1===C?.length&&(console.log("toBottomWhenLoaded",y.current),setTimeout((()=>{console.log("scrollbar",y.current),y.current?.scrollToBottom()}),500))}),[C]);const A=(0,m.useCallback)((()=>{D(!0)}),[]),I=(0,m.useCallback)((()=>{D(!1)}),[]),U=((0,m.useCallback)((a=>{const n=new FormData;if(a.target.files)for(let e=0;e<a.target.files.length;e++){const t=a.target.files[e].getAsFile();console.log("... file["+e+"].name = "+t.name),n.append("image",t)}g().post(`/api/workspaces/${e}/channels/${t}/images`,n).then((()=>{}))}),[]),(0,m.useCallback)((a=>{a.preventDefault(),console.log(a);const n=new FormData;if(a.dataTransfer.items){for(let e=0;e<a.dataTransfer.items.length;e++)if("file"===a.dataTransfer.items[e].kind){const t=a.dataTransfer.items[e].getAsFile();console.log(a,".... file["+e+"].name = "+t.name),n.append("image",t)}}else for(let e=0;e<a.dataTransfer.files.length;e++)console.log(a,"... file["+e+"].name = "+a.dataTransfer.files[e].name),n.append("image",a.dataTransfer.files[e]);g().post(`/api/workspaces/${e}/channels/${t}/images`,n).then((()=>{B(!1)}))}),[e,t])),j=(0,m.useCallback)((e=>{e.preventDefault(),console.log(e),B(!0)}),[]);if(!a||!a)return null;const q=(0,u.Z)(C?C.flat().reverse():[]);return m.createElement(i,{onDrop:U,onDragOver:j},m.createElement(h,null,m.createElement("span",null,"#",t),m.createElement("div",{className:"header-right"},m.createElement("span",null,E?.length),m.createElement("button",{onClick:A,className:"c-button-unstyled p-ia__view_header__button","aria-label":"Add people to #react-native","data-sk":"tooltip_parent",type:"button"},m.createElement("i",{className:"c-icon p-ia__view_header__button_icon c-icon--add-user","aria-hidden":"true"})))),m.createElement(l.Z,{chatSections:q,ref:y,setSize:_,isReachingEnd:$}),m.createElement(n.Z,{chat:c,onChangeChat:d,onSubmitForm:F}),m.createElement(s.Z,{show:S,onCloseModal:I,setShowInviteChannelModal:D}),z&&m.createElement(p,null,"업로드!"))}}}]);