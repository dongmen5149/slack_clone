"use strict";(self.webpackChunkslack_clone=self.webpackChunkslack_clone||[]).push([[94],{3094:(e,t,a)=>{a.r(t),a.d(t,{default:()=>v});var n=a(2309),r=a(2545),s=a(8678),l=a(2951),o=a(3274);const c=(0,o.Z)("div",{target:"eb1dzis2"})({name:"1a0r0eh",styles:"display:flex;flex-wrap:wrap;height:calc(100vh - 38px);flex-flow:column;position:relative"}),i=(0,o.Z)("header",{target:"eb1dzis1"})({name:"1c17pcy",styles:"height:64px;display:flex;width:100%;--saf-0:rgba(var(--sk_foreground_low, 29, 28, 29), 0.13);box-shadow:0 1px 0 var(--saf-0);padding:20px 16px 20px 20px;font-weight:bold;align-items:center;& img{margin-right:5px;}"}),d=(0,o.Z)("div",{target:"eb1dzis0"})({name:"czjct4",styles:"position:absolute;top:64px;left:0;width:100%;height:calc(100% - 64px);background:white;opacity:0.7;display:flex;align-items:center;justify-content:center;font-size:40px"});var p=a(3564),f=a(8667),m=a(9669),u=a.n(m),g=a(7294),h=a(6182),k=a.n(h),w=a(6974),x=a(821),b=a(958);const v=()=>{const{workspace:e,id:t}=(0,w.UO)(),{data:a}=(0,x.ZP)(`/api/workspaces/${e}/users/${t}`,p.Z),{data:o}=(0,x.ZP)("/api/users",p.Z),[m,h,v]=(0,s.Z)(""),{data:T,mutate:Z,setSize:E}=(0,b.ZP)((a=>`/api/workspaces/${e}/dms/${t}/chats?perPage=20&page=${a+1}`),p.Z),[S]=(0,l.Z)(e),y=0===T?.[0]?.length||T&&T[T.length-1]?.length<20||!1,C=(0,g.useRef)(null),[$,z]=(0,g.useState)(!1),D=(0,g.useCallback)((n=>{if(n.preventDefault(),console.log(m),m?.trim()&&T){const n=m;Z((e=>(e?.[0].unshift({id:(T[0][0]?.id||0)+1,content:n,SenderId:o.id,Sender:o,ReceiverId:a.id,Receiver:a,createdAt:new Date}),e)),!1).then((()=>{v(""),C.current?.scrollToBottom()})),u().post(`/api/workspaces/${e}/dms/${t}/chats`,{content:m}).then((()=>{Z()})).catch(console.error)}}),[m,T,o,a,e,t]),B=(0,g.useCallback)((e=>{e.SenderId===Number(t)&&o.id!==Number(t)&&Z((t=>(t?.[0].unshift(e),t)),!1).then((()=>{C.current&&C.current.getScrollHeight()<C.current.getClientHeight()+C.current.getScrollTop()+150&&(console.log("scrollToBottom!",C.current?.getValues()),setTimeout((()=>{C.current?.scrollToBottom()}),50))}))}),[]);(0,g.useEffect)((()=>(S?.on("dm",B),()=>{S?.off("dm",B)})),[S,B]),(0,g.useEffect)((()=>{1===T?.length&&setTimeout((()=>{C.current?.scrollToBottom()}),100)}),[T]);const P=(0,g.useCallback)((a=>{a.preventDefault(),console.log(a);const n=new FormData;if(a.dataTransfer.items){for(let e=0;e<a.dataTransfer.items.length;e++)if("file"===a.dataTransfer.items[e].kind){const t=a.dataTransfer.items[e].getAsFile();console.log("... file["+e+"].name = "+t.name),n.append("image",t)}}else for(let e=0;e<a.dataTransfer.files.length;e++)console.log("... file["+e+"].name = "+a.dataTransfer.files[e].name),n.append("image",a.dataTransfer.files[e]);u().post(`/api/workspaces/${e}/dms/${t}/images`,n).then((()=>{z(!1),Z()}))}),[Z,e,t]),R=(0,g.useCallback)((e=>{e.preventDefault(),console.log(e),z(!0)}),[]);if(!a||!o)return null;const _=(0,f.Z)(T?T.flat().reverse():[]);return g.createElement(c,{onDrop:P,onDragOver:R},g.createElement(i,null,g.createElement("img",{src:k().url(a.email,{s:"24px",d:"retro"}),alt:a.nickname}),g.createElement("span",null,a.nickname)),g.createElement(r.Z,{chatSections:_,ref:C,setSize:E,isReachingEnd:y}),g.createElement(n.Z,{chat:m,onChangeChat:h,onSubmitForm:D}),$&&g.createElement(d,null,"업로드!"))}}}]);